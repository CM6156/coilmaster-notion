# 프로필 데이터 지속성 문제 해결 가이드 🔄

## 🎯 문제 상황
**저장은 성공하지만 다른 페이지 갔다가 오면 프로필 정보가 초기화되는 현상**

## ✅ 해결 방법

### 1️⃣ **이중 백업 시스템 구현**
- **DB 저장**: Supabase users 테이블에 실제 저장
- **로컬 백업**: localStorage에 임시 저장 (48시간 유지)

### 2️⃣ **프로필 로딩 우선순위**
1. **현재 로그인 사용자** (AppContext currentUser)
2. **Supabase auth 사용자** (실제 인증)
3. **DB users 테이블** (프로필 정보)
4. **localStorage 백업** (최근 24시간 이내)
5. **더미 사용자** (마지막 fallback)

## 🔍 디버깅 방법

### 저장할 때 확인사항
**F12 → Console에서 다음 로그 확인:**

```
=== 프로필 업데이트 완료 ===
업데이트된 프로필: { name: "최용수", email: "joon@coilmaster.com", ... }
사용된 사용자 ID: abc123-def456...
================================

DB 저장 상태 확인 중...
✅ DB 저장 확인됨: { name: "최용수", email: "joon@coilmaster.com", ... }
✅ 데이터 일치 확인됨
```

### 페이지 재방문 시 확인사항
**F12 → Console에서 다음 로그 확인:**

```
=== AppContext 인증 확인 ===
Supabase auth user: { id: "abc123...", email: "joon@coilmaster.com" }
users 테이블에서 사용자 정보 찾음: { ... }

=== Profile 컴포넌트 로드 ===
currentUser: { id: "abc123...", name: "최용수", ... }
```

## 🚀 테스트 시나리오

### 시나리오 1: 정상 경우
1. **프로필 저장** → "프로필 업데이트 성공" 메시지
2. **다른 페이지로 이동** (대시보드 등)
3. **프로필 페이지 재방문** → 저장한 정보 그대로 표시

### 시나리오 2: 문제 발생 시
**콘솔에서 다음 중 하나 확인:**

```
❌ DB 저장 확인 실패: 에러메시지
⚠️ 저장된 데이터와 폼 데이터 불일치
localStorage에서 최근 프로필 복원: { ... }
```

## 🛠 문제별 해결방법

### 1. DB 저장 실패
```
❌ DB 저장 확인 실패
```
**해결:** Supabase 연결 상태 확인, RLS 정책 확인

### 2. currentUser 없음
```
currentUser가 없습니다. localStorage 확인 중...
localStorage에서 최근 프로필 복원
```
**해결:** 로그인 상태 재확인, localStorage 백업 활용

### 3. 데이터 불일치
```
⚠️ 저장된 데이터와 폼 데이터 불일치
```
**해결:** 필드 매핑 확인, 타입 검증

## 💾 백업 시스템

### localStorage 키 구조
```
userProfile: 프로필 상세 정보
lastProfileUpdate: 마지막 업데이트 시간
currentUser: 현재 사용자 정보
lastUserLogin: 마지막 로그인 시간
```

### 자동 정리 규칙
- **프로필 백업**: 24시간 후 만료
- **사용자 백업**: 48시간 후 만료
- **만료 시**: 자동 삭제 후 새로운 로그인 필요

## 🎉 기대 효과

✅ **프로필 변경사항 즉시 반영**
✅ **페이지 이동 후에도 데이터 유지**
✅ **네트워크 오류시 로컬 백업 활용**
✅ **더 안정적인 사용자 경험** 